<html>
<head>
<title> MY shopping page </title>
<style>
#h1tag
{
 text-align: center
}

ul{
display:inline-block;
list-style-type: none; 
}

span:before{
    content:" "; 
    display:inline-block; 
    width:40px;
}
button
{

    height:18px;
    width:90px;
    border: 2px solid brown;
  border-radius: 5px;
}
body {background-color:	LightBlue;}
 
</style>
</head>
<body onload="start()" >


<h1 id="h1tag"><font color="Purple">Shopping page</font></h1>

<div id="divdisplay" >

<ul id="ul1">
<span></span>
<li><h3> Product-name </li>
<span></span>
</ul>

<ul id="ul2">
<li><h3> Price </li>
<span></span>
</ul>

<ul id="ul3">
<li><h3> Quantity </li>
<span></span>
</ul>

<ul id="ul4">
<li><h3> Add to cart </li>
<span></span>
</ul>


</div>
<script>

	console.log(sessionStorage.getItem("userid"));

   var productarray=getstored();
   var ulid="1"

    var ii=0; 
	var cart=[];
	
	if(getstoredcart().length!=0)
	cart=getstoredcart();
	
	var cartiterator=0;
	
	function start()
	{
	

	for(var j=0;j<productarray.length;j++)
	displayproducts(productarray[j].name,document.getElementById("ul1"),0,0,productarray[j].roll);
	
	for(var j=0;j<productarray.length;j++)
	displayproducts(productarray[j].price,document.getElementById("ul2"),0,0,productarray[j].roll);
	
	for(var j=0;j<productarray.length;j++)
	displayproducts(productarray[j].quantity,document.getElementById("ul3"),1,0,productarray[j].roll);
	
	for(var j=0;j<productarray.length;j++)
	displayproducts("Add to cart",document.getElementById("ul4"),0,1,productarray[j].roll);
	
	
	}
	function displayproducts(a,b,dropdown,button,productid)
	{
	 if(dropdown!=0)
	 {
	  
	 var li=document.createElement("li");
	 var dropmenu=document.createElement("select");
	 var dropid="drop" + productid;
	 dropmenu.setAttribute("id",dropid);
	 dropmenu.setAttribute("style","width:50px;");
	 dropmenu.textContent="quantity";
	 dropmenu.setAttribute("size","1");
	  
		 for(var j=1;j<=a;j++)
		 {
		 var option=document.createElement("option");
		 option.textContent=j;
		 dropmenu.appendChild(option);
		 }
		 
	 li.appendChild(dropmenu);
	 b.appendChild(li);
	 var br=document.createElement("br");
	 b.appendChild(br);
	 
	 }
	
	else if(button==1)
	{
	var li=document.createElement("li");
	
	var button=document.createElement("button");
	
	//console.log(buttonid);
	button.setAttribute("id",productid);
	button.textContent=a;
	
	li.appendChild(button);
	b.appendChild(li);
	var br=document.createElement("br");
	b.appendChild(br);
	
    button.addEventListener('click', function()
    {
    
    if(!(sessionStorage.getItem("userid")))
    {
    window.location.href="userloginpage.html";
    return false;
    }
    add1(productid);
    
    });
    
	}
			 
	 else
	 {
	 var li=document.createElement("li");
	 li.textContent=a;
	 b.appendChild(li);
	 var br=document.createElement("br");
	 b.appendChild(br);
	 }
	 
	}

    function storedata()
	{
	
	//console.log("hi");
	localStorage.cart=JSON.stringify(cart);
	
	}

    function add1(productid)
	{
	
		for(var j=0;j<productarray.length;j++)
		{
		
		if(productarray[j].roll==productid)
		{
		 
		 //x is for dropdown menu where quantity is mentioned
		  var x="drop" + productid;
		 
			for(var i=0;i<cart.length;i++)
			{
				//check if cart of that user is in cart array or not
				if(cart[i][0].userid==sessionStorage.getItem("userid"))
				{
				 for(var jj=0;jj<cart[i].length;jj++)
				 {
				 
					 //product is alraedy in cart of that user we just have to increase the quantity
					 if(cart[i][jj].roll==productid)
					 {
					 cart[i][jj].quantity= Number(document.getElementById(x).value) +Number(cart[i][jj].quantity);
					 storedata();
					 return;
					 }  
				  }
				  //if that product does not exist in cart of that user than addd that product in cart of that user
					  cart[i].push(productarray[j]); 
					  cart[i][cart[i].length -1].quantity=document.getElementById(x).value;
					  cart[i][cart[i].length -1].userid=sessionStorage.getItem("userid");
					  storedata();
					 return;
				}
			
			}
			
			//create new cart for user and store the cart on local storage
			var userarray=[];
			userarray.push(productarray[j]);
			userarray[userarray.length -1].quantity=document.getElementById(x).value;
			userarray[userarray.length -1].userid=sessionStorage.getItem("userid");
			cart.push(userarray);
			storedata();
			
			
			}
		
		}
	
	}

 function getstored()
     {
     
     if(!localStorage.data)
     {
     localStorage.data=JSON.stringify([]);
     }
     
     return(JSON.parse(localStorage.data));
     }
     
     
      function getstoredcart()
     {
     
     if(!localStorage.cart)
     {
     localStorage.cart=JSON.stringify([]);
     }
     
     return(JSON.parse(localStorage.cart));
     }
     
     
     
</script>







</body>
</html>
